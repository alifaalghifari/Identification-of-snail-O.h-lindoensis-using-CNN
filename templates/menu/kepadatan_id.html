{% extends 'base/base.html' %}

{% block title %}
    Kepadatan Desa {{data_id[0][1]}}
{% endblock %}

{% block content %}
        <div class="m-10">
            <h1 class="text-7xl font-semibold ">Desa {{ data_id[0][1] }} </h1>
            <span class="text-3xl font-semibold ">{{ data_id[0][6] }}</span>
        </div>

    <div class="flex flex-col justify-center itemce gap-2 mx-10 mt-10 ">
        <div class="flex justify-between mb-10">
            <div class="flex justify-center bg-teal-500 self-center py-3 text-white text-2xl rounded-md  cursor-pointer w-40 text-center mr-3 border hover:shadow-lg duration-150" id="edit-btn">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7 self-center mx-1">
                <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" />
                </svg>
                <p id="edit-text">Edit</p>
            </div>
            
            <div class="flex justify-center bg-red-500 self-center py-3 text-white text-2xl rounded-md cursor-pointer w-28 text-center hover:shadow-lg duration-150">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7 ">
                <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                </svg>
                Hapus
            </div>
        </div>
        <form action="{{ url_for('KepadatanRoutes.save_kepadatan', id=data_id[0][0]) }}" method="post">
            <div class="flex justify-between">
                <div class="border-2 w-80 p-3 bg-blue-100 flex flex-col justify-around group shadow-xl hover:shadow-none duration-200">
                    <p class="text-2xl text-center font-semibold">Jumlah Keong</p>
                    <div class="flex justify-center gap-5 mt-5 rounded-md shadow-none bg-blue-200/90 p-3 border border-blue-200/90 group-hover:shadow-lg group-hover:border-blue-200/90 duration-200">
                        <img src="{{ url_for('static', filename='icon/snail.png') }}" alt="" class="w-10 h-10 inline">
                        <input type="number" name="jml_keong" class="self-center text-2xl w-10 text-gray-500 bg-transparent appearance-none  leading-tight focus:outline-none" value="{{ data_id[0][2] }}" id="num-keong" readonly="readonly"  />
                    </div>
                </div>
                <div class="border-2 w-80 p-3 bg-slate-100 flex flex-col justify-around group shadow-xl hover:shadow-none duration-200">
                    <p class="text-2xl text-center font-semibold">Jumlah Orang</p>
                    <div class="flex justify-center gap-5 mt-5 rounded-md shadow-none bg-slate-200/90 p-3 self-center w-full border border-slate-100/90 group-hover:shadow-lg group-hover:border-slate-200/90 duration-200">
                        <img src="{{ url_for('static', filename='icon/people.png') }}" alt="" class="w-10 h-10 inline">
                        <input type="number" name="jml_orang" class="self-center text-2xl w-10 text-gray-500 bg-transparent appearance-none  leading-tight focus:outline-none" value="{{ data_id[0][3] }}" id="num-orang" readonly="readonly" />
                    </div>
                </div>
                <div class="border-2 w-80 p-3 bg-orange-50 group shadow-xl hover:shadow-none duration-200">
                    <p class="text-2xl text-center font-semibold">Jumlah Titik</p>
                    <div>
                        <div class="border p-2 rounded">
                            <div class="border-b-4 pb-1 flex justify-center" >
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-10 h-10 text-slate-400">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
                                </svg>
                                <input type="number" name="jml_titik" class="self-center text-2xl w-10 text-gray-500 bg-transparent appearance-none  leading-tight focus:outline-none" value="{{ data_id[0][4] }}" id="num-titik" readonly="readonly"  />
                            </div>
                            <p id="timer-display" class="text-center text-2xl">4m 59s</p>
                        </div>
                        <p class="text-center bg-blue-400 text-slate-100 rounded mt-2 cursor-pointer p-2 text-2xl hover:shadow-lg" id="startCount">Mulai</p>
                    </div>
                </div>
                <div class="border-2 w-80 p-3 bg-green-200 flex flex-col justify-around group shadow-xl hover:shadow-none duration-200">
                    <p class="text-2xl text-center font-semibold">Kepadatan </p>
                    <div class="flex justify-center gap-5 mt-5 rounded-md shadow-none bg-green-100/80 p-3 self-center w-full border border-green-200/90 group-hover:shadow-lg group-hover:border-green-200/90 duration-200">
                        <img src="{{ url_for('static', filename='icon/people.png') }}" alt="" class="w-10 h-10 inline">
                        <input class="self-center text-2xl w-16 bg-transparent focus:outline-none" value="{{ data_id[0][5] }}" readonly />
                    </div>
                </div>
            </div>
        </div>
        <div class="m-10 flex justify-center">
            <button type="submit" class="flex justify-center w-full bg-green-500 self-center py-3 text-white text-2xl rounded-md  cursor-pointer text-center hover:shadow-lg duration-150" id="sumbit-button">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7 self-center mx-1">
                <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 12c0-1.232-.046-2.453-.138-3.662a4.006 4.006 0 00-3.7-3.7 48.678 48.678 0 00-7.324 0 4.006 4.006 0 00-3.7 3.7c-.017.22-.032.441-.046.662M19.5 12l3-3m-3 3l-3-3m-12 3c0 1.232.046 2.453.138 3.662a4.006 4.006 0 003.7 3.7 48.656 48.656 0 007.324 0 4.006 4.006 0 003.7-3.7c.017-.22.032-.441.046-.662M4.5 12l3 3m-3-3l-3 3" />
                </svg>
                Hitung / Simpan
            </button>
        </div>
    </form>

    <script>
        let timeRef = document.querySelector('.timer-display')
        let startBtn = document.getElementById('startCount')
        let inCount = false 
        let numTitik = document.getElementById('num-titik')
        // let numCount = 0

        // fungsi untuk menghitung mundur selama 5 menit
        function count(){
            inCount = !inCount
            
            let date = new Date()
            let add_5m = date.setMinutes(date.getMinutes() + 5)
            let arrCount = []
            let cuntDown = setInterval(function(){

                let now = new Date().getTime()
                let dist = add_5m - now

                let minutes = Math.floor((dist % (1000 * 60 * 60)) / (1000 * 60));
                let seconds = Math.floor((dist % (1000 * 60)) / 1000);
                
                document.getElementById("timer-display").innerHTML = minutes + "m " + seconds + "s ";
                const reduceeZero =  value => (value < 10 ? "0" + value : value);

                if (dist < 0) {
                    clearInterval(cuntDown);
                    document.getElementById("timer-display").innerHTML = "EXPIRED";

                    let numCount = Number(numTitik.value)
                    console.log(numCount)
                    numTitik.value = numCount + 1
                    inCount = !inCount
                }
            }, 1000)

            
        }

        // mengecek apakah timer sedang berjalan
        function startCount(){
     
            if(inCount == true){
                alert('sedang menghitung')
            }else{
                count()
            }
        }

        // handling user meng-klik tombol mulai
        startBtn.addEventListener('click', this.startCount)
        

        // handling tombol edit
        let editBtn = document.getElementById('edit-btn')
        let numKeong = document.getElementById('num-keong')
        let numOrang = document.getElementById('num-orang')
        let editText = document.getElementById('edit-text')
        let onEditing = false

        let submitBtn = document.getElementById('sumbit-button')

        editBtn.addEventListener('click', function toggleEdit(){
            onEditing = !onEditing

            if(onEditing == true){
                editText.innerText = 'On Editing'
                window.FlashMessage.info('Mode edit ON !');

                editBtn.classList.add('bg-transparent')
                editBtn.classList.add('text-teal-500')
                editBtn.classList.add('border-teal-500')

                // mengatur input untuk jumlah keong saat editing
                numKeong.removeAttribute('readonly')
                numKeong.classList.add('bg-slate-200')
                // mengatur input untuk jumlah orang saat editing
                numOrang.removeAttribute('readonly')
                numOrang.classList.add('bg-slate-50')
                // mengatur input untuk jumlah titik saat editing
                numTitik.removeAttribute('readonly')
                numTitik.classList.add('bg-slate-200')

            }else{
                editText.innerText = 'Edit'
                window.FlashMessage.info('Mode edit OFF !');

                editBtn.classList.remove('bg-transparent')
                editBtn.classList.remove('text-teal-500')
                editBtn.classList.remove('border-teal-500')

                // mengatur input untuk jumlah keong saat disable editing
                numKeong.setAttribute('readonly', true)
                numKeong.classList.remove('bg-slate-200')
                // mengatur input untuk jumlah orang saat disable editing
                numOrang.setAttribute('readonly', true);
                numOrang.classList.remove('bg-slate-50')
                // numOrang.classList.add('bg-bg-transparent')
    
                // mengatur input untuk jumlah titik saat disable editing
                numTitik.setAttribute('readonly', true);
                numTitik.classList.remove('bg-slate-200')
            }
        } )

        // saat user klik submit button, check apakah on editing aktf
        

        submitBtn.addEventListener('click', function check_editing(e){
            
            if(onEditing == true){
                e.preventDefault()
                window.FlashMessage.warning('Mode edit sedang berlansung, Matikan mode edit !');
            }
        })

    </script>

{% endblock %}